<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=1024" />
<title>Coco Peat Pilot – Comprehensive Financial Report & Analysis</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<!-- External Library for Charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
--primary-color:#556B2F;--secondary-color:#8FBC8F;--accent-color:#D2B48C;
--text-color:#3D403A;--light-bg:#F5F5DC;--container-bg:rgba(255,255,255,.9);
--border-color:rgba(0,0,0,.08);--shadow:0 8px 32px 0 rgba(135,135,135,.15);
--font-heading:'Playfair Display',serif;--font-body:'Lato',sans-serif;
--profit-color:#556B2F; --loss-color:#A0522D; --warning-bg: #fffbe6; --warning-border: #ffe58f;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:var(--font-body);line-height:1.8;color:var(--text-color);
background:linear-gradient(170deg,#F0F2EB 0%,#E6E8E1 100%);
-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
.container{max-width:960px;margin:40px auto;background:var(--container-bg);
border-radius:20px;box-shadow:var(--shadow);backdrop-filter:blur(10px);
-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);
padding:50px 60px}
.content-section{padding:35px 0;border-bottom:1px solid var(--border-color)}
.content-section:last-of-type{border-bottom:none}
h1,h2,h3{font-family:var(--font-heading);color:var(--primary-color);font-weight:700}
h1{font-size:3em;margin-bottom:10px;line-height:1.2}
h2{font-size:2.2em;margin-bottom:25px;padding-bottom:15px;border-bottom:1px solid var(--secondary-color)}
h3{font-size:1.4em;margin-bottom:15px}
h4{font-size:1.1em;margin-bottom:15px;color: var(--primary-color);}
p{margin-bottom:1.2em;font-weight:300;font-size:1.05em;text-align:justify}
strong{font-weight:700}
a{color:var(--primary-color);text-decoration:none}
a:hover{text-decoration:underline}
.header{text-align:center;padding-bottom:30px}
.header .subtitle{font-size:1.1em;color:#555;font-weight:400}
.grid{display:grid;gap:24px}
.grid.two{grid-template-columns:1fr 1fr}
.grid.three{grid-template-columns:repeat(3,1fr)}
.card{background:rgba(255,255,255,.6);border:1px solid rgba(255,255,255,.35);
border-radius:16px;padding:22px;box-shadow:0 4px 15px rgba(0,0,0,.05)}
.tag{display:inline-block;padding:.2em .6em;border-radius:999px;font-size:.8em;
background:#F0F2EB;color:#556B2F;border:1px solid #C9D0C2;margin-right:.35rem}
.muted{color:#666;font-size:.95em}
.table{width:100%;border-collapse:separate;border-spacing:0;margin-top:10px;
font-size:.95em;border:1px solid var(--border-color);border-radius:12px;overflow:hidden}
.table th,.table td{padding:12px 14px;text-align:left;border-bottom:1px solid var(--border-color)}
.table th{background:#F0F2EB;color:var(--primary-color);font-weight:700;letter-spacing:.3px;font-size:.85em;text-transform:uppercase}
.table tfoot td{font-weight:700;background:rgba(143,188,143,.15)}
.small{font-size:.9em}
.note{background:var(--warning-bg);border:1px solid var(--warning-border);border-radius:10px;padding:12px 14px;font-size:.95em}
.inputs{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:8px}
.inputs label{font-size:.85em;color:#333; cursor: help;}
.inputs input{width:100%;padding:10px;border:1px solid #d6d6d6;border-radius:10px;background:white}
.inputs div { position: relative; }
.btn{margin-top:10px;display:inline-block;background:var(--primary-color);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer; font-weight: bold; font-size: 0.9em;}
.btn-group{display:flex;flex-wrap: wrap; gap:10px;align-items:center;margin-top:15px}
.btn.secondary{background-color:#8FBC8F}.btn.tertiary{background-color:#D2B48C;color:#3D403A}.btn.quaternary{background-color:#666; color:white;}
.profit{color:var(--profit-color);font-weight:700;}.loss{color:var(--loss-color);font-weight:700;}
.footer{text-align:center;margin-top:20px;padding-top:20px;font-size:.9em;color:#999}
@media (max-width:768px){h1{font-size:2.2em}h2{font-size:1.6em}.container{margin:20px;padding:24px}.grid.two,.grid.three{grid-template-columns:1fr}.inputs{grid-template-columns:1fr}.btn-group{flex-direction:column;align-items:stretch}}
</style>
</head>
<body>
<main class="container">
<header class="header">
<h1>Coco Peat Business Financial Plan</h1>
<div class="subtitle">An Interactive Analysis of Cost, Profitability, and Risk</div>
<p class="muted" style="text-align:center;margin-top:8px">This report models the export of one 20-foot container of 5kg coco peat blocks from Tamil Nadu, India, to Los Angeles, USA.</p>
</header>

<!-- Executive Summary -->
<section class="content-section">
  <h2>Executive Summary & Key Findings</h2>
  <div class="card">
      <h3>The Business Case</h3>
      <p>This analysis confirms the viability of exporting coco peat to the high-demand Southern California market. The business model is built on supplying a sustainable, water-efficient product to the agriculture, landscaping, and hydroponics industries. The core of this report is an interactive financial calculator, based on personally gathered, real-world data, that allows for transparent analysis of all costs and profits.</p>
      <h3>Critical Factor: The 50% Tariff</h3>
      <p>A central assumption of this model is a <strong>hypothetical 50% tariff</strong> on goods imported from India. This represents a significant financial challenge and is included as a worst-case scenario for risk planning. The tariff dramatically increases the landed cost of our product.</p>
      <h3>The Bottom Line: Profitability Under Pressure</h3>
      <p>Despite the severe impact of the tariff, the analysis shows that the business remains profitable, albeit with tighter margins. The default scenario projects:</p>
      <ul>
          <li>A <strong>Net Landed Cost of $8.15 per 5kg block</strong> (including the tariff).</li>
          <li>A <strong>Wholesale Gross Margin of 29.1%</strong> when selling at $11.50 per block.</li>
          <li>A potential <strong>Net Profit of over $11,000 per month</strong> based on selling one container.</li>
      </ul>
       <p class="note">This confirms that while the tariff is a major hurdle, the business's strong underlying economics and the high value of the product in the U.S. market allow it to maintain viability. Success will depend on efficient operations and securing volume sales at the target wholesale price.</p>
    </div>
</section>

<!-- How to Read This Report -->
<section class="content-section">
    <h2>Understanding the Numbers: A Simple Guide</h2>
    <p>This report is designed to be fully transparent. Below are simple explanations for the key terms and how to use the interactive calculator.</p>
    <div class="grid two">
        <div class="card">
            <h4>Key Financial Terms Explained</h4>
            <ul class="small">
                <li><strong>CIF Value (Cost, Insurance, Freight):</strong> This is the total value of the goods when they arrive at the U.S. port, *before* duties and taxes. It includes the factory cost, Indian logistics, ocean shipping, and insurance. The 50% tariff is calculated based on this value.</li>
                <li><strong>Landed Cost:</strong> This is the total, all-in cost to get one 5kg block from our factory in India to our warehouse in Los Angeles, ready for sale. It is the most important cost figure in this report.</li>
                <li><strong>Gross Margin:</strong> This is the direct profit made on each block, calculated as (Selling Price - Landed Cost). A higher margin indicates a more profitable business.</li>
                 <li><strong>Working Capital Cost:</strong> This represents the cost of the money tied up while the product is being shipped and stored. It can be thought of as the interest paid on a loan used to finance the inventory.</li>
            </ul>
        </div>
        <div class="card">
            <h4>How to Use the Interactive Calculator</h4>
            <p class="small">The "Financial Model & Calculator" section below is the engine of this report. It is pre-loaded with our real-world data.</p>
            <ul class="small">
                <li><strong>Hover for Details:</strong> For a clear explanation of any item, simply hover your mouse over its label in the calculator. A tooltip will appear with a simple definition.</li>
                <li><strong>Adjust Any Value:</strong> Click on any number and type a new one to instantly see how it affects all other calculations. This is useful for "what-if" analysis (e.g., "What if ocean freight increases by $500?").</li>
                <li><strong>Load Scenarios:</strong> Use the buttons to automatically load Default, Best-Case, or Worst-Case numbers to see a range of potential outcomes.</li>
            </ul>
        </div>
    </div>
</section>


<!-- Assumptions & Calculator -->
<section class="content-section">
  <h2>Financial Model & Calculator</h2>
  <div class="card">
    <p class="muted">This calculator drives the entire report. It is pre-filled with the real-world data I have personally collected. All tables and charts below will update automatically when you change a value here.</p>
    <div class="inputs" id="calc_inputs">
      <!-- Input fields will be dynamically populated by JS -->
    </div>
    <div class="btn-group">
        <button class="btn" id="default_case">Load Defaults</button>
        <button class="btn secondary" id="best_case">Load Best-Case</button>
        <button class="btn tertiary" id="worst_case">Load Worst-Case</button>
        <button class="btn quaternary" id="toggle_currency">Toggle Currency ($/₹)</button>
    </div>
  </div>

  <div class="grid two" style="margin-top:20px">
    <div class="card">
      <h3>Detailed Landed Cost per 5kg Block</h3>
      <p class="muted small" style="text-align:left; margin-bottom:10px;">This table shows every single cost that goes into one 5kg block, from the factory floor to the U.S. warehouse. The 50% tariff is the largest single expense after the product itself.</p>
      <table class="table" id="cost_table">
        <thead><tr><th>Cost Component</th><th id="cost_table_currency_header">Value per Block (US$)</th></tr></thead>
        <tbody></tbody>
        <tfoot>
          <tr><td><strong>Total Landed Cost per Block</strong></td><td id="total_landed">$—</td></tr>
        </tfoot>
      </table>
    </div>
    <div class="card">
      <h3>Landed Cost Breakdown</h3>
      <p class="muted small" style="text-align:left; margin-bottom:10px;">This chart visualizes the major cost categories. It clearly shows the significant impact of the hypothetical tariff on the overall cost structure.</p>
       <canvas id="cost_chart"></canvas>
    </div>
  </div>

   <div class="grid two" style="margin-top:20px">
     <div class="card">
      <h3>Profitability & Margin Analysis</h3>
       <p class="muted small" style="text-align:left; margin-bottom:10px;">This table calculates our potential profit on each block sold. It separates the analysis for bulk wholesale deals and individual retail sales.</p>
      <table class="table" id="margin_table">
        <thead><tr><th>Sales Channel</th><th id="margin_table_sell_header">Sell $/block</th><th id="margin_table_net_header">Net Profit $/block</th><th>Gross Margin</th></tr></thead>
        <tbody>
            <tr><td>Wholesale</td><td id="wh_sell_price">$—</td><td id="wh_net_profit">$—</td><td id="wh_gm">%</td></tr>
            <tr><td>Retail (net of fees)</td><td id="rt_sell_price">$—</td><td id="rt_net_profit">$—</td><td id="rt_gm">%</td></tr>
        </tbody>
        <tfoot><tr><td>Weighted Average Profit</td><td id="w_sell">$—</td><td id="w_net">$—</td><td id="w_gm">—%</td></tr></tfoot>
      </table>
    </div>
    <div class="card">
      <h3>Per-Container & Monthly Profit Projection</h3>
       <p class="muted small" style="text-align:left; margin-bottom:10px;">This table scales up the per-block numbers to show the total potential profit from one shipping container and a projection for monthly earnings after all business overheads are paid.</p>
      <table class="table" id="container_table">
        <thead><tr><th>Metric</th><th id="projection_table_currency_header">Value</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card" style="margin-top:20px">
      <h3>Monthly Operational Overrides</h3>
      <p class="muted small">The inputs here relate to the ongoing, scaled-up business operations. Adjusting these values will only affect the "Monthly Net Profit" calculation in the projection table above.</p>
    <div class="inputs" id="override_inputs" style="grid-template-columns:repeat(4,1fr);margin-top:10px">
       <!-- Override Input fields will be dynamically populated by JS -->
    </div>
  </div>
</section>

<!-- Business Context Sections -->
<section class="content-section">
    <h2>Business Context & Strategy</h2>
    <p class="muted small" style="text-align:left;">The following sections provide the strategic context for the financial numbers above, explaining the supply chain, target market, and legal requirements for the business.</p>
    <!-- Logistics -->
    <h3 style="margin-top:20px;">Logistics & Supply Chain</h3>
    <p class="small">Our supply chain is designed for cost-efficiency and reliability. The process involves three key stages: 1) <strong>Origin Services</strong> in India, including production and trucking to Tuticorin Port; 2) <strong>Ocean Transit</strong> via a 20' container to the Port of Los Angeles; and 3) <strong>Destination Services</strong> in the U.S., including customs clearance, drayage to a warehouse, and storage.</p>
    
    <!-- Marketability -->
    <h3 style="margin-top:20px;">Marketability & Competition</h3>
    <p class="small">Demand for coco peat in California is driven by three powerful trends: stringent water conservation laws, a massive hydroponics and legal cannabis industry, and a consumer shift towards sustainable gardening products. While competitors exist, our strategy is to differentiate on verified quality (low salt content), reliable local stock for fast delivery, and competitive pricing aimed at high-volume B2B customers like nurseries and commercial growers.</p>

    <!-- Compliance -->
    <h3 style="margin-top:20px;">Compliance & Approvals</h3>
    <p class="small">The business will operate in strict compliance with all Indian export and U.S. import regulations. Key requirements include obtaining an Importer-Exporter Code (IEC) in India and ensuring every shipment is accompanied by a <strong>Phytosanitary Certificate</strong> to meet U.S. Department of Agriculture (USDA) standards. The product is naturally duty-free under HS Code 5305.00, but our model conservatively includes a 50% tariff for risk assessment.</p>
</section>

<footer class="footer">
  <p>Prepared by <strong>Vijay Malaichamy Sathappan</strong> · Amara Coconuts · Natham, Tamil Nadu</p>
</footer>

</main>
<script>
// --- GLOBAL VARS ---
let costChart;
let currentCurrency = 'USD'; // 'USD' or 'INR'

// --- DEFAULT DATA with DESCRIPTIONS for TOOLTIPS (from original HTML) ---
const defaultInputs = {
    // India-Side Costs
    inr_per_kg: { label: "Ex-factory cost (₹/kg)", value: 58, step: 1, desc: "The cost for one kilogram of A-grade coco peat directly from the factory in India." },
    inland_inr_cntr: { label: "Inland Haulage (₹/container)", value: 75000, step: 1000, desc: "The total cost to transport one full 20' container by truck from the factory to Tuticorin port." },
    port_inr_cntr: { label: "Port Handling (₹/container)", value: 55000, step: 1000, desc: "All fees at the Indian port, including container stuffing, handling charges, and documentation." },
    // Ocean & U.S.-Side Costs
    ocean_usd: { label: "Ocean Freight (US$/20')", value: 3500, step: 100, desc: "The cost to ship one 20-foot container from Tuticorin, India to Los Angeles, USA." },
    us_port_usd: { label: "US Customs & Clearance (US$)", value: 1100, step: 50, desc: "Fees paid in the U.S. for customs brokerage, import filings (like ISF), and other port fees." },
    dray_usd: { label: "Drayage (US$/container)", value: 650, step: 25, desc: "The cost to move the container by truck from the Port of Los Angeles to our designated local warehouse." },
    wh_usd_mo: { label: "Warehouse Cost (US$/month)", value: 2200, step: 100, desc: "The total monthly cost for storing the contents of one container in a warehouse." },
    // Financial & Operational Metrics
    fx: { label: "FX Rate (₹ per US$)", value: 87.95, step: 0.5, desc: "The foreign exchange rate used to convert Indian Rupees (₹) to U.S. Dollars ($)." },
    kg_per_block: { label: "Kg per Block", value: 5, step: 0.1, desc: "The weight of a single compressed coco peat block." },
    blocks_per_cntr: { label: "Blocks per Container", value: 4000, step: 50, desc: "The total number of 5kg blocks that can be loaded into one 20-foot shipping container." },
    months_hold: { label: "Months Inventory Held", value: 1, step: 0.5, desc: "The average time (in months) the inventory is stored in the warehouse before being sold." },
    ins_pct: { label: "Insurance (% of CIF Value)", value: 1, step: 0.1, desc: "The premium for marine cargo insurance, calculated as a percentage of the total value of the goods plus shipping (CIF)." },
    tariff_pct: { label: "Additional Tariff (%)", value: 50, step: 1, desc: "A hypothetical additional tariff on goods from India, included for risk assessment. Calculated on the CIF value." },
    // Pricing & Sales Mix
    wh_price: { label: "Wholesale Sell Price (US$)", value: 11.5, step: 0.25, desc: "The price we will sell one block for to business customers like nurseries and distributors." },
    rt_price: { label: "Retail Sell Price (US$)", value: 20.0, step: 0.5, desc: "The price a consumer would pay for one block. This is before any marketplace fees." },
    retail_share: { label: "% Blocks to Retail", value: 25, step: 5, desc: "The percentage of our inventory we plan to sell directly to consumers, with the rest going to wholesale." },
    rt_fee_pct: { label: "Retail Channel Fees (%)", value: 15, step: 1, desc: "Fees charged by marketplaces like Amazon, calculated as a percentage of the retail price." }
};


const defaultOverrides = {
    cntrs_per_mo: { label: "Containers per Month", value: 1, step: 1, desc: "The number of containers we plan to import and sell each month." },
    fixed_us_overhead: { label: "Monthly Fixed Overhead (US$)", value: 800, step: 50, desc: "Ongoing monthly costs in the U.S. that don't change with sales, such as insurance, accounting, etc." },
    mkt_per_cntr: { label: "Sales/Marketing per Container (US$)", value: 250, step: 25, desc: "The estimated marketing budget allocated to selling the contents of one container." },
    wc_cost_pct: { label: "Working Capital Cost (%/mo)", value: 1, step: 0.25, desc: "The monthly cost of capital (e.g., loan interest) tied up in inventory value." }
};

// --- UTILITY FUNCTIONS ---
function formatCurrency(usdValue) {
    const fxRate = val('fx');
    if (currentCurrency === 'INR') {
        const inrValue = usdValue * fxRate;
        return '₹' + inrValue.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }
    return '$' + usdValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function pct(x){return (isFinite(x) ? x : 0).toFixed(1) + '%'}
function val(id){return parseFloat(document.getElementById(id).value || 0)}
function setVal(id, value){document.getElementById(id).value=value}
function colorize(el, val) {
    el.classList.remove('profit', 'loss');
    if (val > 0) el.classList.add('profit');
    else if (val < 0) el.classList.add('loss');
}

// --- CORE CALCULATION LOGIC ---
function recalc() {
    const values = {};
    [...Object.keys(defaultInputs), ...Object.keys(defaultOverrides)].forEach(id => {
        const inputEl = document.getElementById(id);
        if (inputEl) values[id] = parseFloat(inputEl.value || 0);
    });

    const {
        inr_per_kg, fx, kg_per_block, blocks_per_cntr, inland_inr_cntr, port_inr_cntr,
        ocean_usd, us_port_usd, dray_usd, wh_usd_mo, months_hold, ins_pct,
        tariff_pct, wh_price, rt_price, retail_share, rt_fee_pct,
        cntrs_per_mo, fixed_us_overhead, mkt_per_cntr, wc_cost_pct
    } = values;

    // --- Per-Block Cost Calculation (all in USD) ---
    const ex_factory_usd = (inr_per_kg * kg_per_block) / fx;
    const india_logistics_usd = ((inland_inr_cntr + port_inr_cntr) / fx) / blocks_per_cntr;
    const ocean_freight_usd = ocean_usd / blocks_per_cntr;
    
    // Calculate CIF Value (Cost + Insurance + Freight)
    const cost_and_freight = ex_factory_usd + india_logistics_usd + ocean_freight_usd;
    const insurance_usd = cost_and_freight * (ins_pct / 100);
    const cif_value = cost_and_freight + insurance_usd;

    // U.S. Side Costs
    const tariff_usd = cif_value * (tariff_pct / 100);
    const us_clearance_usd = us_port_usd / blocks_per_cntr;
    const drayage_usd = dray_usd / blocks_per_cntr;
    const holding_usd = (wh_usd_mo * months_hold) / blocks_per_cntr;

    // Final Landed Cost
    const total_landed = cif_value + tariff_usd + us_clearance_usd + drayage_usd + holding_usd;

    // --- Margin per block calculations (all in USD) ---
    const retailShare = retail_share / 100;
    const wholesale_net = wh_price - total_landed;
    const retail_net_revenue = rt_price * (1 - (rt_fee_pct / 100));
    const retail_net_profit = retail_net_revenue - total_landed;
    
    const weighted_net = (wholesale_net * (1 - retailShare)) + (retail_net_profit * retailShare);
    const weighted_sell_price = (wh_price * (1 - retailShare)) + (rt_price * retailShare);
    
    const wholesale_gm = (wholesale_net / wh_price) * 100;
    const retail_gm = (retail_net_profit / retail_net_revenue) * 100;
    const weighted_gm = (weighted_net / weighted_sell_price) * 100;

    // --- Update UI ---
    const currencySymbol = currentCurrency === 'USD' ? '$' : '₹';
    document.getElementById('cost_table_currency_header').textContent = `Value per Block (${currencySymbol})`;
    document.getElementById('margin_table_sell_header').textContent = `Sell ${currencySymbol}/block`;
    document.getElementById('margin_table_net_header').textContent = `Net Profit ${currencySymbol}/block`;
    document.getElementById('projection_table_currency_header').textContent = `Value (${currencySymbol})`;

    const costRowsData = [
        {label: 'Ex-Factory & India Logistics', value: ex_factory_usd + india_logistics_usd},
        {label: 'Ocean Freight & Insurance', value: ocean_freight_usd + insurance_usd},
        {label: 'Hypothetical 50% Tariff', value: tariff_usd},
        {label: 'U.S. Port, Drayage & Holding', value: us_clearance_usd + drayage_usd + holding_usd}
    ];
    document.querySelector('#cost_table tbody').innerHTML = costRowsData.map(r => `<tr><td>${r.label}</td><td>${formatCurrency(r.value)}</td></tr>`).join('');
    document.getElementById('total_landed').textContent = formatCurrency(total_landed);

    document.getElementById('wh_sell_price').textContent = formatCurrency(wh_price);
    document.getElementById('rt_sell_price').textContent = formatCurrency(retail_net_revenue);
    document.getElementById('wh_net_profit').textContent = formatCurrency(wholesale_net);
    document.getElementById('rt_net_profit').textContent = formatCurrency(retail_net_profit);
    document.getElementById('wh_gm').textContent = pct(wholesale_gm);
    document.getElementById('rt_gm').textContent = pct(retail_gm);
    document.getElementById('w_sell').textContent = formatCurrency(weighted_sell_price);
    document.getElementById('w_net').textContent = formatCurrency(weighted_net);
    document.getElementById('w_gm').textContent = pct(weighted_gm);
    colorize(document.getElementById('wh_net_profit'), wholesale_net);
    colorize(document.getElementById('rt_net_profit'), retail_net_profit);
    colorize(document.getElementById('w_net'), weighted_net);

    const container_gross_profit = weighted_net * blocks_per_cntr;
    const inv_value = total_landed * blocks_per_cntr;
    const wc_cost = inv_value * (wc_cost_pct / 100) * months_hold;
    const monthly_profit = (container_gross_profit * cntrs_per_mo) - fixed_us_overhead - (mkt_per_cntr * cntrs_per_mo) - wc_cost;
    
    document.querySelector('#container_table tbody').innerHTML = [
        ['Container Gross Profit', container_gross_profit],
        ['Inventory Working Capital Cost', wc_cost],
        ['Monthly Net Profit (Est.)', monthly_profit]
    ].map(r => `<tr><td>${r[0]}</td><td id="${r[0].replace(/\s+/g, '')}">${formatCurrency(r[1])}</td></tr>`).join('');
    colorize(document.getElementById('MonthlyNetProfit(Est.)'), monthly_profit);

    const ctx = document.getElementById('cost_chart').getContext('2d');
    if (costChart) costChart.destroy();
    costChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: costRowsData.map(r => r.label),
            datasets: [{ data: costRowsData.map(r => r.value), backgroundColor: ['#556B2F', '#8FBC8F', '#A0522D', '#D2B48C'], borderColor: 'rgba(255,255,255,.9)', borderWidth: 2 }]
        },
        options: {
            responsive: true, animation: { duration: 0 },
            plugins: { legend: { position: 'bottom', labels:{font:{size:10}} }, tooltip: { callbacks: { label: (c) => `${c.label}: $${(c.raw).toFixed(2)} (${(100 * c.raw / c.chart.getDatasetMeta(0).total).toFixed(1)}%)` } } }
        }
    });
}

// --- Event Handlers ---
function loadDefaults() { Object.keys(defaultInputs).forEach(id => setVal(id, defaultInputs[id].value)); Object.keys(defaultOverrides).forEach(id => setVal(id, defaultOverrides[id].value)); recalc(); }
function loadBestCase() { loadDefaults(); setVal('inr_per_kg', 55); setVal('fx', 90); setVal('ocean_usd', 3000); setVal('tariff_pct', 0); setVal('wh_price', 13.0); recalc(); }
function loadWorstCase() { loadDefaults(); setVal('inr_per_kg', 62); setVal('fx', 85); setVal('ocean_usd', 4000); setVal('dray_usd', 850); setVal('months_hold', 2.5); setVal('tariff_pct', 50); recalc(); }
function toggleCurrency() { currentCurrency = (currentCurrency === 'USD') ? 'INR' : 'USD'; recalc(); }

// --- Initialization ---
document.addEventListener('DOMContentLoaded', () => {
    const inputsContainer = document.getElementById('calc_inputs');
    const overridesContainer = document.getElementById('override_inputs');
    
    function createInputs(container, inputsObject) {
        Object.entries(inputsObject).forEach(([id, item]) => {
            container.innerHTML += `<div title="${item.desc}"><label for="${id}">${item.label}</label><input id="${id}" type="number" value="${item.value}" step="${item.step}"></div>`;
        });
    }

    createInputs(inputsContainer, defaultInputs);
    createInputs(overridesContainer, defaultOverrides);
    
    document.getElementById('default_case').addEventListener('click', loadDefaults);
    document.getElementById('best_case').addEventListener('click', loadBestCase);
    document.getElementById('worst_case').addEventListener('click', loadWorstCase);
    document.getElementById('toggle_currency').addEventListener('click', toggleCurrency);

    document.querySelectorAll('#calc_inputs input, #override_inputs input').forEach(input => {
        input.addEventListener('input', recalc);
    });

    loadDefaults();
});
</script>
</body>
</html>
